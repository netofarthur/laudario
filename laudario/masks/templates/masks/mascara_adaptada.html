{% extends "masks/base.html" %}

   {% block css %}

    {% load static %}

    <link rel="stylesheet" type="text/css" href="{% static 'masks/css/mascara.css' %}">
    <script type="text/javascript" src="{% static 'masks/tinymce/js/tinymce/tinymce.min.js' %}"></script>

    {% endblock css %}

{% block conteudo %}


                      <script>


                          tinymce.init({
                            selector: '#relatorio_modal',
                                language: 'pt_BR',

                              menubar: false,
                                      plugins: "table paste",
                                paste_as_text: true,
                                forced_root_block: false,
                            toolbar: "bold italic underline forecolor table",
                              fontsize_formats: '11px 12px 14px 16px 18px 24px 36px 48px',
                                branding: false,
                                  elementpath: false


                          });


                              tinymce.init({
                            selector: '#conclusao_modal',
                                language: 'pt_BR',

                              menubar: false,
                                      plugins: "table paste",
                                    paste_as_text: true,
                        forced_root_block: false,
                            toolbar: "bold italic underline forecolor table",
                              fontsize_formats: '11px 12px 14px 16px 18px 24px 36px 48px',
                                branding: false,
                                  elementpath: false


                          });








                            </script>

<div id="mycontainer">

<div class="container-fluid">

<div class="row">



<div class="col" style="padding: 0px; padding-left: 1rem;">

<div id="botoes_div" style="text-align: center; margin-top:7px">
        <button id="copiar_laudo" style="width:30%; padding: .5rem;" class="btn btn-primary" onclick="copiarRelatorio()">Copiar Relatório</button>
            <button id="editar_laudo" style="width:30%; padding: .5rem; margin-left: 1rem;" class="btn btn-primary" onclick="copiarConclusao()">Copiar Conclusão</button>
        <button id="copiar_tudo" style="width:30%; padding: .5rem; margin-left: 1rem;" class="btn btn-primary" onclick="copiarRelatorioConclusao()">Copiar Tudo</button>

           </div>
<div id="mascara_div">
    <button style="display: none;" type="button" class="btn btn-primary" data-toggle="modal" data-target="#ModalVariaveis" id=popular_variaveis onclick="popularVariaveis()">Preencher Variáveis</button>








<div style="margin: 2rem;">

<p id="relatorio_simples" style="color: #c96100; font-size: 1.5rem; font-weight: bold; text-decoration: none">Relatório</p>









<div id="topicos_div">
{% for topico in topicos_normais %}
    {% autoescape off %}

    <div class="paragrafo_mascara" name="topico" id="{{ topico.pk }}" > {{ topico.relatorio }}</div>

    {% endautoescape %}
    {% endfor %}
</div>





    <p id="conclusao_simples" style="margin-top: 3rem; color: #c96100; font-size: 1.5rem; font-weight: bold; text-decoration: none">Conclusão</p>
    {% autoescape off %}
    <p class="paragrafo_mascara" id="paragrafo_conclusao" name="conclusao"> {{mascara.conclusao}} </p>

    {% endautoescape %}
    <p style="display: none;" id="conclusao_relatorio"></p>

<div style="text-align: center;">
    <a style="font-size: 1.5rem;" id="link_voltar" href="javascript:window.close()">Voltar</a>
</div>


<div>


</div>


</div>



<div class="col-4" style="display: none;>


<div id=diagnosticos_div class="sticky-top">
        <div class="sticky-top">
            {% if usuarioPermitido %}
    <button id="botaoAdicionarAlteracao" type="button" data-toggle="modal" data-target="#myModalAlteracao">Adicionar Alteração</button>
        {% endif %}

            <input autocomplete="off" id="procurarFrases" type="search" placeholder="Procurar frases" onkeyup="procurarFrasesMascara(this.id)" onsearch="procurarFrasesMascara(this.id)"/>
    </div>

    <!--Seta ids únicos para os botões poderem ser reconhecidos e possibiliar abrir Modals com htmls diferentes.
    No primeiro loop são setados os ids dos topicos normais nos bancos de dados e no segundo loop o nome dos arquivos
    html em templates/diagnosticos que também são colocados no banco de dados na entrada template_name em TopicoAnormalBuilders-->




    {% for topicoanormal in topicos_anormais %}
        {% if topicoanormal.topico_normal.mascara == mascara %}
        <div class="container-fluid">
            <div class="row" style="border-top:1px solid black;">
                <div style="padding: 0; text-align: center;" class="col-3" >
                        <input name="{{ topicoanormal.topico_normal.pk }}" class="botao_prioridade" type="image" src="{% static 'masks/images/prioridade.png' %}" onMouseOver="this.src='{% static 'masks/images/prioridade2.png' %}'" onMouseOut="this.src='{% static 'masks/images/prioridade.png' %}'" id="p{{ topicoanormal.pk }}" onclick="alterarDiagnosticoDireto(this.name, this.id)">
                </div>
                <div class="col" style="padding-left: 0;">

                    <button style="text-align: left;" name="{{ topicoanormal.topico_normal.pk }}" type="button" class="botao_diagnostico" id="b{{ topicoanormal.pk }}" onclick="alterarDiagnosticoDireto(this.name, this.id)">{{ topicoanormal.nome }}</button>
           </div>
            </div>
       </div>

        {% endif %}
    {% endfor %}


    {% for topicoanormalbuilder in topicos_anormais_builders %}
        {% if topicoanormalbuilder.topico_normal.mascara == mascara %}
            <button name="{{ topicoanormalbuilder.topico_normal.pk }}" type="button" class="botao_diagnostico" data-toggle="modal" data-target="#myModal" id={{ topicoanormalbuilder.template_name }}>{{ topicoanormalbuilder.nome }}</button>
        {% endif %}
    {% endfor %}

    <form id="formulario_upvote" action="{% url 'upvote_frase' %}" method="post">
        {% csrf_token %}

        <input type="hidden" name="frase_clicada" id="frase_clicada">

    </form>

    <div style="display: none;" id="ultima_alteracao_relatorio"></div>
    <p style="display: none;" id="ultima_alteracao_conclusao"></p>

</div>

</div>






</div>
</div>



    </body>

    </div>

















<script>

    var splits = window.location.href.split("/").reverse();

       var topicosDiv = document.getElementById("topicos_div");

    var children = topicosDiv.children;

    for(i=0; i < children.length; i++) {
        if(children[i].getAttribute("id") === splits[1]) {

        } else {
            children[i].style.display = "none";
            children[i].innerHTML = "";


        }
    }

    document.getElementById("b" + splits[0]).click();


</script>

    {% endblock conteudo %}




