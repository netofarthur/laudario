{% extends "masks/base.html" %}

   {% block css %}

    {% load static %}

    <link rel="stylesheet" type="text/css" href="{% static 'masks/css/mascara.css' %}">

    {% endblock css %}

{% block conteudo %}

<div id="container">

<div id=diagnosticos_div>


    <!--Seta ids únicos para os botões poderem ser reconhecidos e possibiliar abrir Modals com htmls diferentes.
    No primeiro loop são setados os ids dos topicos normais nos bancos de dados e no segundo loop o nome dos arquivos
    html em templates/diagnosticos que também são colocados no banco de dados na entrada template_name em TopicoAnormalBuilders-->
    {% for topicoanormal in topicos_anormais %}
        {% if topicoanormal.topico_normal.mascara == mascara %}
            <button name="{{ topicoanormal.topico_normal.pk }}" type="button" class="botao_diagnostico" id="b{{ topicoanormal.pk }}" onclick="alterarDiagnosticoDireto(this.name, this.id)">{{ topicoanormal.nome }}</button>
        {% endif %}
    {% endfor %}


    {% for topicoanormalbuilder in topicos_anormais_builders %}
        {% if topicoanormalbuilder.topico_normal.mascara == mascara %}
            <button name="{{ topicoanormalbuilder.topico_normal.pk }}" type="button" class="botao_diagnostico" data-toggle="modal" data-target="#myModal" id={{ topicoanormalbuilder.template_name }}>{{ topicoanormalbuilder.nome }}</button>
        {% endif %}
    {% endfor %}
        <button id="botaoAdicionarAlteracao" type="button" data-toggle="modal" data-target="#myModalAlteracao">Adicionar Alteração</button>


</div>


<div id="mascara_div">

<h1 name="titulo"> {{ mascara.titulo }} </h1>
<h2 name="titulo"> {{ mascara.tecnica_header }} </h2>
<p> {{mascara.tecnica }} </p>
<h2> {{ mascara.relatorio_header }} </h2>

<div id="topicos_div">
{% for topico in topicos_normais %}
    <p name="topico" id="{{ topico.pk}}" > {{ topico.relatorio|linebreaksbr }}</p>
{% endfor %}
</div>



<h2> {{ mascara.conclusao_header }} </h2>
<p id="conclusao_normal"> {{ mascara.conclusao }} </p>

<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#ModalVariaveis" id=popular_variaveis onclick="popularVariaveis()">Popular Variáveis</button>
</div>
</div>


    <!-- Modal de Diagnósticos Personalizados-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                  <div id="template_name"></div>

              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button id = "save_changes" type="button" class="btn btn-primary" onclick="alterarDiagnosticoModal()">Save changes</button>
              </div>
            </div>
        </div>


    </div>



    <!-- Modal de Variáveis do Usuário-->
    <div class="modal fade" id="ModalVariaveis" tabindex="-1" role="dialog" aria-labelledby="tituloModalVariaveis" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="tituloModalVariaveis">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                  <div id="template_name_variaveis">


                  </div>

              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button id = "save_changes_variaveis" type="button" class="btn btn-primary" onclick="alterarVariaveisModal()">Save changes</button>
              </div>
            </div>
        </div>


    </div>





    <!-- Modal de Adicionar Alteração-->
    <div class="modal fade" id="myModalAlteracao" tabindex="-1" role="dialog" aria-labelledby="myModalAlteracaoTitle" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                 <form action="{% url 'adicionar_alteracao' %}" method="post">
                        {% csrf_token %}

              <div class="modal-header">
                <h5 class="modal-title" id="myModalAlteracaoTitle">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                  <div id="corpo_alteracao">



                        <div class="form-group">
                          <label for="exames">Tópico a ser alterado </label>
                          <select class="form-control" name ="exames" id="exames">
                            {% for topico_normal in topicos_normais %}
                              <option value={{ topico_normal.pk }}>{{topico_normal.orgao}}</option>
                            {% endfor %}

                          </select>
                            <label for="nome_modal">Nome: </label>
                             <input type="text" id="nome_modal" name="nome_modal"/>
                            <br>

                            <label for="relatorio_modal">Relatório: </label>


                              <input type="text" id="relatorio_modal" name="relatorio_modal"/>
                            <br>

                                <label for="conclusao_modal">Conclusão: </label>
                              <input type="text" id="conclusao_modal" name="conclusao_modal"/>
                        </div>


                            <input type="checkbox" id="adicionar_no_atual" name="adicionar_no_atual" checked/>
                            <label for="adicionar_no_atual">Adicionar na máscara atual</label>
                            <br>



                            <input type="checkbox" id="adicionar_no_banco" name="adicionar_no_banco" checked/>
                            <label for="adicionar_no_banco">Adicionar no meu banco de frases</label>


                  </div>

              </div>

              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button id ="salva_mudancas" type="submit" onclick="adicionarAlteracoNaMascara()">Salvar alteração</button>
              </div>
             </form>
            </div>




        </div>


    </div>

<script>
    function salvarAlteracao() {
        alert("acicionar");
    }
</script>






<!-- Script para mapear os botões/diagnósticos e abrir o template para preencher o modal adequadamente. Os templates
    deverão ficar na pasta diagnósticos e um template_name deve existir para cada TopicoAlterado.-->
    <!-- setAttribute name coloca o id do topico normal a ser alterado no name do botão savechanges,
     para poder alterar o tópico correto depois.-->
<script>

 $('#myModal').on('show.bs.modal', function (e) {

              var button = e.relatedTarget;
              document.getElementById("template_name").setAttribute("w3-include-html", "../diagnosticos/" + button.id);
              document.getElementById("save_changes").setAttribute("name", button.name);

              includeHTML();
        })
</script>

    {% endblock conteudo %}

